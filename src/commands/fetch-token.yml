description: >
  Fetch Installation Token as GITHUB_APP_INSTALLATION_TOKEN
parameters:
  app_id:
    type: string
    description: "ID of the GitHub App"
  installation_id:
    type: integer
    description: "The ID of the installation for which the token will be requested (defaults to the ID of the repository's installation)"
  private_key:
    type: string
    description: "Private key of the GitHub App (can be Base64 encoded)"
steps:
  - jq/install
  - run:
      name: Fetch Installation Token
      command: |
        wget https://github.com/mackee/git-credential-github-apps/releases/download/v1.1.1/git-credential-github-apps_1.1.1_Linux_x86_64.tar.gz 
        tar -zxvf git-credential-github-apps_1.1.1_Linux_x86_64.tar.gz
        chmod 755 git-credential-github-apps
        mv git-credential-github-apps /usr/bin/git-credential-github-apps
        echo -e << parameters.private_key >> > /tmp/key.pem
        export $(echo -e 'host=github.com\nprotocol=https' |  git-credential-github-apps -privatekey /tmp/key.pem -appid << parameters.app_id >> -login ostk0069 get | grep password)
        echo "export GITHUB_APP_TOKEN=${password}" >> $BASH_ENV
